<html lang="en">

<head>
  <title>Happy 2nd Anniversery ❤️</title>
  <style>
    html,
    body,
    .snow {
      height: 100%;
      width: 100%;
      overflow: hidden;
      margin: 0;
    }
  </style>
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2663/2663067.png" type="image/x-icon">
  <link rel="shortcut icon" href="https://cdn-icons-png.flaticon.com/512/2663/2663067.png" type="image/x-icon">
  <link rel="stylesheet" href="./css/index.css">
  <script type="text/javascript" src="./js/jquery.js"></script>
  <script type="text/javascript" src="./js/three.js"></script>
  <script src="./js/count-time.js"></script>

</head>

<body>
  <div class="music">
    <i class="iconfont music-close">&#xea28;</i>
    <!-- <audio class="audio" src="./media/dongxi-md.mp3" preload autoplay loop></audio>  -->
    <audio class="audio" preload autoplay loop>
      <source src="/BGM.mp3" type="audio/mp3" /> Your
      browser does not support the audio element.
    </audio>
  </div>
  <div class="banner ovh">
    <div class="swiper-wrap">
      <!-- <img src="./images/DSC_0692_mix01.jpg" alt=""> -->
      <!-- <img src="./img/20180319230435.jpg" alt=""> -->
      <img id="current-img" src="./images/WE.jpeg" alt="">
      <p class="img-intro">Love You So Much Baby ♾️</p>
    </div>
    <!-- <video class="video hide" webkit-playsinline="" playsinline="" x5-playsinline="" controls loop src=""></video> -->
  </div>
  <p class="intro self-design">🐼 Happy 2nd Anniversary ❤️</p>
  <p class="date self-design">
    <span id="day" class="time-font"></span>
    <span class="date-icon" style="color:red" data-text="days">/&nbsp;</span>
    <span id="hour" class="time-font"></span>
    <span class="date-icon" style="color:red" data-text="hours">/&nbsp;</span>
    <span id="minute" class="time-font"></span>
    <span class="date-icon" style="color:red" data-text="min">/&nbsp;</span>
    <span id="second" class="time-font"></span>
    <span class="date-icon" style="color:red" data-text="sec">/&nbsp;</span>
  </p>
  <p class="svg">
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <lottie-player src="https://assets1.lottiefiles.com/packages/lf20_jvxwtdtp.json" background="transparent"
      speed="0.7" loop autoplay></lottie-player>
  </p>
  <p class="our-name self-design">🐇 Chicoo <span> - $ - </span> Bachaa 🐻</p>
  <script type="text/javascript">
    //设置起始日期
    countTime('2021/03/01 17:35', 'day', 'hour', 'minute', 'second');
    var days = parseInt($('#day').text());
    var years = new Date().getFullYear();
    var month = new Date().getMonth() + 1;
    var dateDay = new Date().getDate();
    // 设置标题
    if (month == 3 && dateDay == 12) {
      $(document).attr("", "" + parseInt(years - 2021) + "年,始于初见,终于到老。");
    } else if (dateDay == 12) {
      $(document).attr("", "" + parseInt(days / 30) + "个月,始于初见,终于到老。");
    } else
      $(document).attr("", "" + days + "天,始于初见,终于到老。");
    document.writeln(
      "<div class=\"snow\" style=\"height:100%; position:fixed; left:0px; top:0px;right:0px; bottom:0px; pointer-events: none;z-index: 9999;\"><canvas width=\"1904\" height=\"913\" style=\"position:absolute;left: 0;top: 0;\"></canvas></div>"
    );

    $(function () {

      if (/MSIE 6|MSIE 7|MSIE 8/.test(navigator.userAgent)) {
        return
      }
      var container = document.querySelector(".snow");
      // IE9-10 pointer-events兼容
      if (/MSIE 9|MSIE 10/.test(navigator.userAgent)) {
        $(container).bind('click mousemove', function (evt) {
          this.style.display = 'none';
          var x = evt.pageX,
            y = evt.pageY
          if ($(document).scrollTop() > 0 || $(document).scrollTop() > 0) {
            x = x - $(document).scrollLeft() + 1
            y = y - $(document).scrollTop() + 1
          }
          evt.preventDefault();
          evt.stopPropagation();
          var under = document.elementFromPoint(x, y);
          var evtType = evt.type === 'click' ? 'click' : 'mouseenter'
          if (evt.type === 'click') {
            $(under)[0].click();
          } else {
            $(under).trigger('mouseenter');
          }
          $('body').css('cursor', 'default')
          this.style.display = '';
          return false;
        });
      }
      var containerWidth = $(container).width();
      var containerHeight = $(container).height();
      var particle;
      var camera;
      var scene;
      var renderer;
      var mouseX = 0;
      var mouseY = 0;
      var windowHalfX = window.innerWidth / 2;
      var windowHalfY = window.innerHeight / 2;
      var particles = [];
      var particleImages = [new Image(), new Image(), new Image(), new Image(), new Image()];
      // particleImages[0].src = "./images/snow1.png";
      // particleImages[1].src = "./images/snow2.png";
      // particleImages[2].src = "./images/snow3.png";
      // particleImages[3].src = "./images/snow4.png";
      // particleImages[4].src = "./images/snow5.png";
      particleImages[0].src = "./img/151375665240370100.png";
      particleImages[1].src = "./img/151375668550091372.png";
      particleImages[2].src = "./img/151375669416355455.png";
      particleImages[3].src = "./img/151375670204115466.png";
      particleImages[4].src = "./img/151375671039447316.png";
      var snowNum = 300;

      function init() {
        camera = new THREE.PerspectiveCamera(75, containerWidth / containerHeight, 1, 10000);
        camera.position.z = 1000;
        scene = new THREE.Scene();
        scene.add(camera);
        renderer = new THREE.CanvasRenderer();
        renderer.setSize(containerWidth, containerHeight);
        for (var i = 0; i < snowNum; i++) {
          var material = new THREE.ParticleBasicMaterial({
            map: new THREE.Texture(particleImages[i % 5])
          });
          particle = new Particle3D(material);
          particle.position.x = Math.random() * 2000 - 1000;
          particle.position.y = Math.random() * 2000 - 1000;
          particle.position.z = Math.random() * 2000 - 1000;
          particle.scale.x = particle.scale.y = 1;
          scene.add(particle);
          particles.push(particle)
        }
        container.appendChild(renderer.domElement);
        document.addEventListener("mousemove", onDocumentMouseMove, false);
        document.addEventListener("touchstart", onDocumentTouchStart, false);
        document.addEventListener("touchmove", onDocumentTouchMove, false);
        setInterval(loop, 1000 / 50)
      }

      function onDocumentMouseMove(event) {
        mouseX = event.clientX - windowHalfX;
        mouseY = event.clientY - windowHalfY
      }

      function onDocumentTouchStart(event) {
        if (event.touches.length === 1) {
          event.preventDefault();
          mouseX = event.touches[0].pageX - windowHalfX;
          mouseY = event.touches[0].pageY - windowHalfY
        }
        event.preventDefault();
      }

      function onDocumentTouchMove(event) {
        if (event.touches.length === 1) {
          event.preventDefault();
          mouseX = event.touches[0].pageX - windowHalfX;
          mouseY = event.touches[0].pageY - windowHalfY
        }
        event.preventDefault();
      }

      function loop() {
        for (var i = 0; i < particles.length; i++) {
          var particle = particles[i];
          // 滚动到楼层模块，减少雪花 （自定义）
          if ($(window).scrollTop() < 1000) {
            particle.scale.x = particle.scale.y = 1;
          } else {
            if (i > particles.length / 5 * 3) {
              particle.scale.x = particle.scale.y = 0;
            } else {
              particle.scale.x = particle.scale.y = 0.8;
            }
          }
          particle.updatePhysics();
          with (particle.position) {
            if (y < -1000) {
              y += 2000
            }
            if (x > 1000) {
              x -= 2000
            } else {
              if (x < -1000) {
                x += 2000
              }
            }
            if (z > 1000) {
              z -= 2000
            } else {
              if (z < -1000) {
                z += 2000
              }
            }
          }
        }
        camera.position.x += (mouseX - camera.position.x) * 0.005;
        camera.position.y += (-mouseY - camera.position.y) * 0.005;
        camera.lookAt(scene.position);
        renderer.render(scene, camera)
      }
      init()
    });
  </script>
</body>
<script>
  var musicDom = document.querySelector('.music');
  // var bannerDom = document.querySelector('.banner');
  var audioDom = document.querySelector('.audio');
  // var videoDom = document.querySelector('.video');
  // var swiperWrapDom = document.querySelector('.swiper-wrap');
  // var playVideo = document.querySelector('.our-name');
  var musicCloseDom = musicDom.querySelector('.music-close');
  var curImgDom = document.getElementById('current-img');
  if (audioDom.readyState == 4) { // android会走此逻辑
    // @todo
    console.log('loaded');
  } else { // iOS走此逻辑
    audioDom.addEventListener('play', function () {
      try {
        musicCloseDom.classList.add('rotate');
      } catch (error) {
        // console.log('error', error);
      }
    }, false);
    audioDom.addEventListener('canplaythrough', function () {
      try {
        // chrome浏览器没有也页面交互（点击，滚动）之前会报错误---Uncaught（in promise）DOMException：play（）
        //处理方法设置浏览器autoplay-policy---https://blog.csdn.net/super_XYQ/article/details/83026792
        var promise = audioDom.play();
        if (promise !== undefined) {
          promise.then(function () {
            musicCloseDom.classList.add('rotate');
          }).catch(function () {
            musicCloseDom.classList.remove('rotate');
          });
        }
      } catch (error) {
        console.log('error', error);
      }
    }, false);
    audioDom.load();
  }

  musicDom.addEventListener('click', function (event) {
    if (!audioDom.paused) {
      audioDom.pause();
      musicCloseDom.classList.remove('rotate');
    } else {
      audioDom.play();
      musicCloseDom.classList.add('rotate');
    }

    event.preventDefault();
  }, false);

  function loadImage(imgIndex) {
    // console.log('imgIndex:',imgIndex);
    // var img = new Image();
    curImgDom.src = imgList[imgIndex];
    // curImgDom.setAttribute('src', imgList[imgIndex]);
    if (isInitImage) {
      $('.img-intro').text(imgDescList[imgIndex]);
      return;
    } else {
      // curImgDom.src = imgList[imgIndex];
      if (curImgDom.complete) {
        $('.img-intro').text(imgDescList[imgIndex]);
        return false;
      }
      curImgDom.onload = function () {
        $('.img-intro').text(imgDescList[imgIndex]);
      };
    }

  }
  var imgList = [
    './images/WE.jpeg',
    './images/Snapchat-1039022003.jpg',
    './images/Snapchat-53153351.jpg',
    './images/letter.jpg',
    './images/new.jpeg',
    './images/couple.jpg',
    './images/img2.jpg',
    './images/img4.jpg',
    './images/copy3.jpg',
    './images/sample1.jpg',
    './images/sample2.jpg',
    './images/sample3.jpg',
    './images/sample4.jpg',
    './images/sweet.jpg',
    './images/sweet2.jpg',
    './images/sweet3.jpg',
    './images/sweet4.jpg',
    './images/ks.jpg',
    './images/hand.jpg',
    './images/angry.jpg',
    './images/locket.jpg',
    './images/first.jpg',
    './images/love-hand.gif',
  ];
  var imgDescList = ['Love You So Much Baby ♾️'
    , 'I am very lucky to have you ❤️'
    , 'Word are not enough to express our feelings 💮'
    , 'Our first letter 💮'
    , 'You + Me = World 🌎'
    , '2 Years of Togetherness 💌'
    , 'Tu mera Humdard hai🌻'
    , 'We are made for Eachother 🐼'
    , 'I never knew love until, I met you 🌼'
    , 'Thank you for being with me 🐻‍❄️'
    , 'You bring joy to my life 🤡'
    , 'We are the perfect pair 💖'
    , 'No one understand me like you🍦'
    , 'Your smile lights up my day 🐭'
    , 'My sweet Roshgulla 🍬'
    , 'I am never leave you alone 🐹'
    , 'Mahh Baby Girllll 🐣'
    , 'You complete me in every way🐣'
    , 'i am never leave your hand 💍'
    , 'My Cute Angry Bird 🍃'
    , 'I will love you endlessly 👻'
    , 'The photo is not perfect, but we are 👌🏻'
    , 'Once Again Love You 💞'
  ];
  var isInitImage = false;
  var imgIndex = 0;
  function setTimer() {
    var timer = setInterval(function () {
      imgIndex = 1 + imgIndex;
      if (imgIndex > (imgList.length - 1)) {
        imgIndex = 0;
        if (!isInitImage) {
          isInitImage = true;
          curImgDom.onload = null;
        }
      }
      imgIndex = (imgIndex > (imgList.length - 1)) ? 0 : imgIndex;
      loadImage(imgIndex);
    }, 4550);
    return timer;
  }
  var timer = setTimer();
</script>

</html>